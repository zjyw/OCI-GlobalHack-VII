{"version":3,"sources":["public/src/admin/appearance/themes.js"],"names":["define","translator","Benchpress","Themes","init","$","on","e","target","action","attr","parentEl","parents","themeType","cssSrc","themeId","socket","emit","type","id","src","err","app","alertError","message","config","highlightSelectedTheme","alert","alert_id","title","timeout","clickfn","require","instance","rebuildAndRestart","bootbox","confirm","themes","instListEl","length","append","addClass","translateHtml","parse","html","translate","text","split","select","current","removeClass","find"],"mappings":"AAAA,aAGAA,OAAO,2BAA4B,aAAc,cAAe,SAAUC,EAAYC,GACrF,IAAIC,KAEJA,EAAOC,KAAO,WACbC,EAAE,qBAAqBC,GAAG,QAAS,SAAUC,GAC5C,IAAIC,EAASH,EAAEE,EAAEC,QACjB,IAAIC,EAASD,EAAOE,KAAK,eAEzB,GAAID,GAAUA,IAAW,MAAO,CAC/B,IAAIE,EAAWH,EAAOI,QAAQ,gBAC9B,IAAIC,EAAYF,EAASD,KAAK,aAC9B,IAAII,EAASH,EAASD,KAAK,YAC3B,IAAIK,EAAUJ,EAASD,KAAK,cAE5BM,OAAOC,KAAK,oBACXC,KAAML,EACNM,GAAIJ,EACJK,IAAKN,GACH,SAAUO,GACZ,GAAIA,EAAK,CACR,OAAOC,IAAIC,WAAWF,EAAIG,SAE3BC,OAAO,YAAcV,EACrBW,EAAuBX,GAEvBO,IAAIK,OACHC,SAAU,cACVV,KAAM,OACNW,MAAO,4CACPL,QAAS,kDACTM,QAAS,IACTC,QAAS,WACRC,SAAS,0BAA2B,SAAUC,GAC7CA,EAASC,8BAQf7B,EAAE,iBAAiBC,GAAG,QAAS,WAC9B6B,QAAQC,QAAQ,6CAA8C,SAAUA,GACvE,GAAIA,EAAS,CACZpB,OAAOC,KAAK,oBACXC,KAAM,QACNC,GAAI,wBACF,SAAUE,GACZ,GAAIA,EAAK,CACR,OAAOC,IAAIC,WAAWF,EAAIG,SAE3BE,EAAuB,wBACvBJ,IAAIK,OACHC,SAAU,cACVV,KAAM,UACNW,MAAO,4CACPL,QAAS,6CACTM,QAAS,cAOdd,OAAOC,KAAK,4BAA6B,SAAUI,EAAKgB,GACvD,GAAIhB,EAAK,CACR,OAAOC,IAAIC,WAAWF,EAAIG,SAG3B,IAAIc,EAAajC,EAAE,qBAEnB,IAAKgC,EAAOE,OAAQ,CACnBD,EAAWE,OAAOnC,EAAE,UAAUoC,SAAS,aAAaC,cAAc,8CAC5D,CACNxC,EAAWyC,MAAM,6BAChBN,OAAQA,GACN,SAAUO,GACZ3C,EAAW4C,UAAUD,EAAM,SAAUA,GACpCN,EAAWM,KAAKA,GAChBlB,EAAuBD,OAAO,qBAOnC,SAASC,EAAuBX,GAC/Bd,EAAW4C,UAAU,0FAA2F,SAAUC,GACzHA,EAAOA,EAAKC,MAAM,UAClB,IAAIC,EAASF,EAAK,GAClB,IAAIG,EAAUH,EAAK,GAEnBzC,EAAE,gBACA6C,YAAY,YACZC,KAAK,uBACLP,KAAKI,GACLE,YAAY,eACZT,SAAS,eAEXpC,EAAE,gBAAkBU,EAAU,MAC5B0B,SAAS,YACTU,KAAK,uBACLP,KAAKK,GACLC,YAAY,eACZT,SAAS,iBAIb,OAAOtC","file":"public/src/admin/appearance/themes.js","sourcesContent":["'use strict';\n\n\ndefine('admin/appearance/themes', ['translator', 'benchpress'], function (translator, Benchpress) {\n\tvar Themes = {};\n\n\tThemes.init = function () {\n\t\t$('#installed_themes').on('click', function (e) {\n\t\t\tvar target = $(e.target);\n\t\t\tvar action = target.attr('data-action');\n\n\t\t\tif (action && action === 'use') {\n\t\t\t\tvar parentEl = target.parents('[data-theme]');\n\t\t\t\tvar themeType = parentEl.attr('data-type');\n\t\t\t\tvar cssSrc = parentEl.attr('data-css');\n\t\t\t\tvar themeId = parentEl.attr('data-theme');\n\n\t\t\t\tsocket.emit('admin.themes.set', {\n\t\t\t\t\ttype: themeType,\n\t\t\t\t\tid: themeId,\n\t\t\t\t\tsrc: cssSrc,\n\t\t\t\t}, function (err) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t}\n\t\t\t\t\tconfig['theme:id'] = themeId;\n\t\t\t\t\thighlightSelectedTheme(themeId);\n\n\t\t\t\t\tapp.alert({\n\t\t\t\t\t\talert_id: 'admin:theme',\n\t\t\t\t\t\ttype: 'info',\n\t\t\t\t\t\ttitle: '[[admin/appearance/themes:theme-changed]]',\n\t\t\t\t\t\tmessage: '[[admin/appearance/themes:restart-to-activate]]',\n\t\t\t\t\t\ttimeout: 5000,\n\t\t\t\t\t\tclickfn: function () {\n\t\t\t\t\t\t\trequire(['admin/modules/instance'], function (instance) {\n\t\t\t\t\t\t\t\tinstance.rebuildAndRestart();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t$('#revert_theme').on('click', function () {\n\t\t\tbootbox.confirm('[[admin/appearance/themes:revert-confirm]]', function (confirm) {\n\t\t\t\tif (confirm) {\n\t\t\t\t\tsocket.emit('admin.themes.set', {\n\t\t\t\t\t\ttype: 'local',\n\t\t\t\t\t\tid: 'nodebb-theme-persona',\n\t\t\t\t\t}, function (err) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t}\n\t\t\t\t\t\thighlightSelectedTheme('nodebb-theme-persona');\n\t\t\t\t\t\tapp.alert({\n\t\t\t\t\t\t\talert_id: 'admin:theme',\n\t\t\t\t\t\t\ttype: 'success',\n\t\t\t\t\t\t\ttitle: '[[admin/appearance/themes:theme-changed]]',\n\t\t\t\t\t\t\tmessage: '[[admin/appearance/themes:revert-success]]',\n\t\t\t\t\t\t\ttimeout: 3500,\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tsocket.emit('admin.themes.getInstalled', function (err, themes) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tvar instListEl = $('#installed_themes');\n\n\t\t\tif (!themes.length) {\n\t\t\t\tinstListEl.append($('<li/ >').addClass('no-themes').translateHtml('[[admin/appearance/themes:no-themes]]'));\n\t\t\t} else {\n\t\t\t\tBenchpress.parse('admin/partials/theme_list', {\n\t\t\t\t\tthemes: themes,\n\t\t\t\t}, function (html) {\n\t\t\t\t\ttranslator.translate(html, function (html) {\n\t\t\t\t\t\tinstListEl.html(html);\n\t\t\t\t\t\thighlightSelectedTheme(config['theme:id']);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\n\tfunction highlightSelectedTheme(themeId) {\n\t\ttranslator.translate('[[admin/appearance/themes:select-theme]]  ||  [[admin/appearance/themes:current-theme]]', function (text) {\n\t\t\ttext = text.split('  ||  ');\n\t\t\tvar select = text[0];\n\t\t\tvar current = text[1];\n\n\t\t\t$('[data-theme]')\n\t\t\t\t.removeClass('selected')\n\t\t\t\t.find('[data-action=\"use\"]')\n\t\t\t\t.html(select)\n\t\t\t\t.removeClass('btn-success')\n\t\t\t\t.addClass('btn-primary');\n\n\t\t\t$('[data-theme=\"' + themeId + '\"]')\n\t\t\t\t.addClass('selected')\n\t\t\t\t.find('[data-action=\"use\"]')\n\t\t\t\t.html(current)\n\t\t\t\t.removeClass('btn-primary')\n\t\t\t\t.addClass('btn-success');\n\t\t});\n\t}\n\n\treturn Themes;\n});\n"]}