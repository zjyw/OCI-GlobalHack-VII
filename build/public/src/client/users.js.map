{"version":3,"sources":["public/src/client/users.js"],"names":["define","translator","Benchpress","Users","searchTimeoutID","$","window","on","clearTimeout","init","app","enterRoom","section","utils","params","removeClass","find","location","pathname","parent","addClass","handleSearch","handleInvite","socket","removeListener","onUserStatusChange","setTimeout","doSearch","username","val","activeSection","getActiveSection","query","page","loadPage","term","sortBy","getSortBy","is","onlineOnly","bannedOnly","flaggedOnly","qs","decodeURIComponent","param","get","config","relative_path","renderSearchResults","fail","xhrErr","responseJSON","error","alertError","data","parse","pagination","html","replaceWith","translate","translated","timeago","startsWith","updateUser","updateUserStatus","uid","status","bootbox","prompt","email","emit","err","message","alertSuccess"],"mappings":"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","file":"public/src/client/users.js","sourcesContent":["'use strict';\n\n\ndefine('forum/users', ['translator', 'benchpress'], function (translator, Benchpress) {\n\tvar\tUsers = {};\n\n\tvar searchTimeoutID = 0;\n\n\t$(window).on('action:ajaxify.start', function () {\n\t\tif (searchTimeoutID) {\n\t\t\tclearTimeout(searchTimeoutID);\n\t\t\tsearchTimeoutID = 0;\n\t\t}\n\t});\n\n\tUsers.init = function () {\n\t\tapp.enterRoom('user_list');\n\n\t\tvar section = utils.params().section ? ('?section=' + utils.params().section) : '';\n\t\t$('.nav-pills li').removeClass('active').find('a[href=\"' + window.location.pathname + section + '\"]').parent().addClass('active');\n\n\t\thandleSearch();\n\n\t\thandleInvite();\n\n\t\tsocket.removeListener('event:user_status_change', onUserStatusChange);\n\t\tsocket.on('event:user_status_change', onUserStatusChange);\n\t};\n\n\tfunction handleSearch() {\n\t\tsearchTimeoutID = 0;\n\n\t\t$('#search-user').on('keyup', function () {\n\t\t\tif (searchTimeoutID) {\n\t\t\t\tclearTimeout(searchTimeoutID);\n\t\t\t\tsearchTimeoutID = 0;\n\t\t\t}\n\n\t\t\tsearchTimeoutID = setTimeout(doSearch, 150);\n\t\t});\n\n\t\t$('.search select, .search input[type=\"checkbox\"]').on('change', function () {\n\t\t\tdoSearch();\n\t\t});\n\t}\n\n\tfunction doSearch() {\n\t\t$('[component=\"user/search/icon\"]').removeClass('fa-search').addClass('fa-spinner fa-spin');\n\t\tvar username = $('#search-user').val();\n\t\tvar activeSection = getActiveSection();\n\n\t\tvar query = {\n\t\t\tsection: activeSection,\n\t\t\tpage: 1,\n\t\t};\n\n\t\tif (!username) {\n\t\t\treturn loadPage(query);\n\t\t}\n\n\t\tquery.term = username;\n\t\tquery.sortBy = getSortBy();\n\n\t\tif ($('.search .online-only').is(':checked') || (activeSection === 'online')) {\n\t\t\tquery.onlineOnly = true;\n\t\t}\n\t\tif (activeSection === 'banned') {\n\t\t\tquery.bannedOnly = true;\n\t\t}\n\t\tif (activeSection === 'flagged') {\n\t\t\tquery.flaggedOnly = true;\n\t\t}\n\n\t\tloadPage(query);\n\t}\n\n\tfunction getSortBy() {\n\t\tvar sortBy;\n\t\tvar activeSection = getActiveSection();\n\t\tif (activeSection === 'sort-posts') {\n\t\t\tsortBy = 'postcount';\n\t\t} else if (activeSection === 'sort-reputation') {\n\t\t\tsortBy = 'reputation';\n\t\t} else if (activeSection === 'users') {\n\t\t\tsortBy = 'joindate';\n\t\t}\n\t\treturn sortBy;\n\t}\n\n\n\tfunction loadPage(query) {\n\t\tvar qs = decodeURIComponent($.param(query));\n\t\t$.get(config.relative_path + '/api/users?' + qs, renderSearchResults).fail(function (xhrErr) {\n\t\t\tif (xhrErr && xhrErr.responseJSON && xhrErr.responseJSON.error) {\n\t\t\t\tapp.alertError(xhrErr.responseJSON.error);\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction renderSearchResults(data) {\n\t\tBenchpress.parse('partials/paginator', { pagination: data.pagination }, function (html) {\n\t\t\t$('.pagination-container').replaceWith(html);\n\t\t});\n\n\t\tBenchpress.parse('users', 'users', data, function (html) {\n\t\t\ttranslator.translate(html, function (translated) {\n\t\t\t\ttranslated = $(translated);\n\t\t\t\t$('#users-container').html(translated);\n\t\t\t\ttranslated.find('span.timeago').timeago();\n\t\t\t\t$('[component=\"user/search/icon\"]').addClass('fa-search').removeClass('fa-spinner fa-spin');\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction onUserStatusChange(data) {\n\t\tvar section = getActiveSection();\n\n\t\tif ((section.startsWith('online') || section.startsWith('users'))) {\n\t\t\tupdateUser(data);\n\t\t}\n\t}\n\n\tfunction updateUser(data) {\n\t\tapp.updateUserStatus($('#users-container [data-uid=\"' + data.uid + '\"] [component=\"user/status\"]'), data.status);\n\t}\n\n\tfunction getActiveSection() {\n\t\treturn utils.params().section || '';\n\t}\n\n\tfunction handleInvite() {\n\t\t$('[component=\"user/invite\"]').on('click', function () {\n\t\t\tbootbox.prompt('Email: ', function (email) {\n\t\t\t\tif (!email) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tsocket.emit('user.invite', email, function (err) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t}\n\t\t\t\t\tapp.alertSuccess('[[users:invitation-email-sent, ' + email + ']]');\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\treturn Users;\n});\n"]}