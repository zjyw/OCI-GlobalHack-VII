{"version":3,"sources":["public/src/client/topic/move-post.js"],"names":["define","components","postSelect","MovePost","moveModal","moveCommit","init","$","on","onMovePostsClicked","window","onAjaxifyStart","closeMoveModal","off","openMovePostModal","showPostsSelected","pids","length","find","translateHtml","checkMoveButtonEnable","val","removeAttr","attr","postEl","app","parseAndTranslate","html","document","body","append","onPostToggled","togglePostSelection","movePosts","tid","socket","emit","err","alertError","message","forEach","pid","get","fadeOut","this","remove","disable"],"mappings":"AAAA,aAGAA,OAAO,yBAA0B,aAAc,cAAe,SAAUC,EAAYC,GACnF,IAAIC,KAEJ,IAAIC,EACJ,IAAIC,EAEJF,EAASG,KAAO,WACfC,EAAE,UAAUC,GAAG,QAAS,iCAAkCC,GAC1DF,EAAEG,QAAQF,GAAG,uBAAwBG,IAGtC,SAASA,IACRC,IACAL,EAAEG,QAAQG,IAAI,uBAAwBF,GAGvC,SAASF,IACRN,EAASW,oBAGV,SAASC,IACR,GAAIb,EAAWc,KAAKC,OAAQ,CAC3Bb,EAAUc,KAAK,SAASC,cAAc,2BAA6BjB,EAAWc,KAAKC,OAAS,UACtF,CACNb,EAAUc,KAAK,SAASC,cAAc,2BAIxC,SAASC,IACR,GAAIhB,EAAUc,KAAK,YAAYG,MAAMJ,QAAUf,EAAWc,KAAKC,OAAQ,CACtEZ,EAAWiB,WAAW,gBAChB,CACNjB,EAAWkB,KAAK,WAAY,OAI9BpB,EAASW,kBAAoB,SAAUU,GACtCC,IAAIC,kBAAkB,8BAAgC,SAAUC,GAC/DvB,EAAYuB,EAEZtB,EAAaD,EAAUc,KAAK,uBAE5BX,EAAEqB,SAASC,MAAMC,OAAO1B,GAExBA,EAAUc,KAAK,6BAA6BV,GAAG,QAASI,GACxDR,EAAUc,KAAK,YAAYV,GAAG,QAASY,GACvClB,EAAWI,KAAKyB,GAChBhB,IAEA,GAAIS,EAAQ,CACXtB,EAAW8B,oBAAoBR,EAAQO,GAGxC1B,EAAWG,GAAG,QAAS,WACtByB,SAKH,SAASF,IACRX,IACAL,IAGD,SAASkB,IACR,IAAIC,EAAM9B,EAAUc,KAAK,YAAYG,MACrCc,OAAOC,KAAK,mBAAqBpB,KAAMd,EAAWc,KAAMkB,IAAKA,GAAO,SAAUG,GAC7E,GAAIA,EAAK,CACR,OAAOZ,IAAIa,WAAWD,EAAIE,SAE3BrC,EAAWc,KAAKwB,QAAQ,SAAUC,GACjCxC,EAAWyC,IAAI,OAAQ,MAAOD,GAAKE,QAAQ,IAAK,WAC/CpC,EAAEqC,MAAMC,aAIVjC,MAIF,SAASA,IACR,GAAIR,EAAW,CACdA,EAAUyC,SACVzC,EAAY,KAGbF,EAAW4C,UAIZ,OAAO3C","file":"public/src/client/topic/move-post.js","sourcesContent":["'use strict';\n\n\ndefine('forum/topic/move-post', ['components', 'postSelect'], function (components, postSelect) {\n\tvar MovePost = {};\n\n\tvar moveModal;\n\tvar moveCommit;\n\n\tMovePost.init = function () {\n\t\t$('.topic').on('click', '[component=\"topic/move-posts\"]', onMovePostsClicked);\n\t\t$(window).on('action:ajaxify.start', onAjaxifyStart);\n\t};\n\n\tfunction onAjaxifyStart() {\n\t\tcloseMoveModal();\n\t\t$(window).off('action:ajaxify.start', onAjaxifyStart);\n\t}\n\n\tfunction onMovePostsClicked() {\n\t\tMovePost.openMovePostModal();\n\t}\n\n\tfunction showPostsSelected() {\n\t\tif (postSelect.pids.length) {\n\t\t\tmoveModal.find('#pids').translateHtml('[[topic:fork_pid_count, ' + postSelect.pids.length + ']]');\n\t\t} else {\n\t\t\tmoveModal.find('#pids').translateHtml('[[topic:fork_no_pids]]');\n\t\t}\n\t}\n\n\tfunction checkMoveButtonEnable() {\n\t\tif (moveModal.find('#topicId').val().length && postSelect.pids.length) {\n\t\t\tmoveCommit.removeAttr('disabled');\n\t\t} else {\n\t\t\tmoveCommit.attr('disabled', true);\n\t\t}\n\t}\n\n\tMovePost.openMovePostModal = function (postEl) {\n\t\tapp.parseAndTranslate('partials/move_post_modal', {}, function (html) {\n\t\t\tmoveModal = html;\n\n\t\t\tmoveCommit = moveModal.find('#move_posts_confirm');\n\n\t\t\t$(document.body).append(moveModal);\n\n\t\t\tmoveModal.find('.close,#move_posts_cancel').on('click', closeMoveModal);\n\t\t\tmoveModal.find('#topicId').on('keyup', checkMoveButtonEnable);\n\t\t\tpostSelect.init(onPostToggled);\n\t\t\tshowPostsSelected();\n\n\t\t\tif (postEl) {\n\t\t\t\tpostSelect.togglePostSelection(postEl, onPostToggled);\n\t\t\t}\n\n\t\t\tmoveCommit.on('click', function () {\n\t\t\t\tmovePosts();\n\t\t\t});\n\t\t});\n\t};\n\n\tfunction onPostToggled() {\n\t\tcheckMoveButtonEnable();\n\t\tshowPostsSelected();\n\t}\n\n\tfunction movePosts() {\n\t\tvar tid = moveModal.find('#topicId').val();\n\t\tsocket.emit('posts.movePosts', { pids: postSelect.pids, tid: tid }, function (err) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\t\t\tpostSelect.pids.forEach(function (pid) {\n\t\t\t\tcomponents.get('post', 'pid', pid).fadeOut(500, function () {\n\t\t\t\t\t$(this).remove();\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tcloseMoveModal();\n\t\t});\n\t}\n\n\tfunction closeMoveModal() {\n\t\tif (moveModal) {\n\t\t\tmoveModal.remove();\n\t\t\tmoveModal = null;\n\t\t}\n\n\t\tpostSelect.disable();\n\t}\n\n\n\treturn MovePost;\n});\n"]}